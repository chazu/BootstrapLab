<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>OROM/SVG</title>
    <style>
    svg circle:hover {
      fill: lightgreen;
    }
    svg line {
      stroke-width: 2;
      stroke-opacity: 1;
      pointer-events: none;
      visibility: visible;
    }
    svg line.arrow {
      visibility: visible;
    }
    svg rect {
      stroke: white;
      shape-rendering: crispEdges;
    }
    textarea {
      background: lightgray;
    }
    svg foreignObject {
      pointer-events: none;
    }
    textarea {
      pointer-events: all;
    }
    </style>
  </head>
  <body>
    <svg>
      <g id="box-1" class="root" transform="translate(0,0)">
        <g id="next-id">18</g>
        <rect fill="black" x="0" y="0" width="1348.3799999999999" height="963.27"></rect>
        <text font-family="Arial Narrow" x="5" y="20" fill="white">root</text>
        <g id="box-2" class="vtable-vtable" transform="translate(21,55)">
          <rect fill="grey" height="504" width="447"></rect>
          <text font-family="Arial Narrow" x="5" y="20" fill="white">vtable-vtable</text>
          <g id="box-3" class="vtable" transform="translate(11,45)">
            <rect fill="grey" height="46" width="229"></rect>
            <text font-family="Arial Narrow" x="5" y="20" fill="white">vtable</text>
            <g transform="translate(203,27)">
              <circle r="10" fill="white" stroke="black" id="circle-13">circle-14</circle>
            </g>
          </g>
          <g id="box-4" class="parent" transform="translate(254,48)">
            <rect fill="grey" height="40" width="181"></rect>
            <text font-family="Arial Narrow" x="5" y="20" fill="white">parent</text>
            <g transform="translate(158,25)">
              <circle r="10" fill="white" stroke="black" id="circle-1">circle-2</circle>
            </g>
          </g>
          <g id="box-5" class="methods" transform="translate(13,105)">
            <rect fill="grey" height="384" width="419"></rect>
            <text font-family="Arial Narrow" x="5" y="20" fill="white">methods</text>
            <g id="box-6" class="lookup" transform="translate(13,42)">
              <rect fill="grey" height="169" width="389"></rect>
              <text font-family="Arial Narrow" x="5" y="20" fill="white">lookup</text>
              <foreignObject x="5" y="30" width="100%" height="100%">
                <textarea style="width: 366px; height: 117px;">(rcv, name) =&gt; {
  let box = path_lookup(rcv, 'methods', name);
  if (!box) return;
  let src = svg_userData(box).svg.textarea.value;
  let impl = compile(src);
  return impl;
}</textarea>
              </foreignObject>
            </g>
            <g id="box-7" class="say-hello" transform="translate(19,230)">
              <rect fill="grey" height="141" width="387"></rect>
              <text font-family="Arial Narrow" x="5" y="20" fill="white">say-hello</text>
              <foreignObject x="5" y="30" width="100%" height="100%">
                <textarea style="width: 366px; height: 91px;">() =&gt; {
  alert('Hello, World!');
}</textarea>
              </foreignObject>
            </g>
          </g>
          <circle id="circle-12" cx="440" cy="79"></circle>
          <circle id="circle-14" cx="234" cy="81"></circle>
        </g>
        <g id="box-8" class="object-vtable" transform="translate(477,12)">
          <rect fill="grey" height="139" width="213"></rect>
          <text font-family="Arial Narrow" x="5" y="20" fill="white">object-vtable</text>
          <g id="box-9" class="vtable" transform="translate(7,30)">
            <rect fill="grey" height="69" width="112"></rect>
            <text font-family="Arial Narrow" x="5" y="20" fill="white">vtable</text>
            <g transform="translate(82,46)">
              <circle r="10" fill="white" stroke="black" id="circle-11">circle-12</circle>
            </g>
          </g>
          <g id="box-10" class="parent" transform="translate(128,32)">
            <rect fill="grey" height="66" width="74"></rect>
            <text font-family="Arial Narrow" x="5" y="20" fill="white">parent</text>
          </g>
          <circle id="circle-2" cx="515" cy="128"></circle>
        </g>
        <g class="init" transform="translate(902,59)">
          <rect fill="grey" height="794" width="431"></rect>
          <text font-family="Arial Narrow" x="5" y="20" fill="white">init</text>
          <foreignObject x="5" y="30" width="100%" height="100%">
            <textarea style="width: 408px; height: 750px; font-family: 'Arial Narrow';">() =&gt; {
  vtable_vtable = path_lookup('vtable-vtable');
  vtable_lookup = get_func(vtable_vtable, 'methods', 'lookup');
  object_vtable = follow_arrow(path_lookup(vtable_vtable, 'parent'));

  orom = {}; // IMPORTANT...!
  orom.send = get_func('send');
  orom.bind = get_func('bind');

  debugger;

  orom.send(vtable_vtable, 'say-hello');

  console.log('Init finished');
}</textarea>
          </foreignObject>
        </g>
      <g class="send" transform="translate(490,281)">
        <rect fill="grey" height="108" width="329"></rect>
        <text font-family="Arial Narrow" x="5" y="20" fill="white">send</text>
        <foreignObject x="5" y="30" width="100%" height="100%">
          <textarea style="width: 307px; height: 58px;">(rcv, selector, ...args) =&gt; {
  let impl = orom.bind(rcv, selector);
  return impl(rcv, ...args);
}</textarea>
        </foreignObject>
      </g>
      <g class="bind" transform="translate(481,402)">
        <rect fill="grey" height="223" width="413"></rect>
        <text font-family="Arial Narrow" x="5" y="20" fill="white">bind</text>
        <foreignObject x="5" y="30" width="100%" height="100%">
          <textarea style="width: 392px; height: 177px;">(rcv, selector) =&gt; {
  if (rcv === vtable_vtable
      &amp;&amp; selector === 'lookup') {
    return vtable_lookup(rcv, selector);
  } else {
    let vtable = follow_arrow(
      path_lookup(rcv, 'vtable')
    );
    return orom.send(vtable, 'lookup', selector);
  }
}</textarea>
          </foreignObject>
        </g>
      </g>
    </svg>
    <script src="orom-svg.js"></script>
    <script type="text/javascript">
      get_func('init')();
    </script>
  </body>
</html>
